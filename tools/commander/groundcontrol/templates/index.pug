doctype html
html(lang='en-us')
  head
    meta(charset='utf-8')
    title Commander
    meta(name='description', content='')
    meta(name='author', content='')
    meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no')
    link(rel='stylesheet', type='text/css', media='screen', href='static/bower_components/bootstrap/dist/css/bootstrap.css')
    link(rel='stylesheet', type='text/css', media='screen', href='static/bower_components/font-awesome/css/font-awesome.css')
    link(rel='stylesheet', type='text/css', media='screen', href='static/bower_components/font-mfizz/css/font-mfizz.css')
    // SmartAdmin Styles : Caution! DO NOT change the order
    link(rel='stylesheet', type='text/css', media='screen', href='static/css/commander-production-plugins.css')
    link(rel='stylesheet', type='text/css', media='screen', href='static/css/commander-production.css')//KK
    link(rel='stylesheet', type='text/css', media='screen', href='static/css/commander-skins.css')
    // DEV links : turn this on when you like to develop directly
    // <link rel="stylesheet" type="text/css" media="screen" href="../Source_UNMINIFIED_CSS/smartadmin-production.css">
    // <link rel="stylesheet" type="text/css" media="screen" href="../Source_UNMINIFIED_CSS/smartadmin-skins.css">
    // SmartAdmin RTL Support
    link(rel='stylesheet', type='text/css', media='screen', href='static/css/commander-rtl.css')
    link(rel='stylesheet', type='text/css', media='screen', href='static/css/windhover.css')
    // #FAVICONS
    link(rel='shortcut icon', href='static/img/favicon/favicon.ico', type='image/x-icon')
    link(rel='icon', href='static/img/favicon/favicon.ico', type='image/x-icon')
    // #GOOGLE FONT
    link(rel='stylesheet', type='text/css', media='screen', href='static/css/google-fonts.css')
    // #APP SCREEN / ICONS
    link(rel='apple-touch-icon', href='static/img/splash/sptouch-icon-iphone.png')
    link(rel='apple-touch-icon', sizes='76x76', href='static/img/splash/touch-icon-ipad.png')
    link(rel='apple-touch-icon', sizes='120x120', href='static/img/splash/touch-icon-iphone-retina.png')
    link(rel='apple-touch-icon', sizes='152x152', href='static/img/splash/touch-icon-ipad-retina.png')
    // iOS web-app metas : hides Safari UI Components and Changes Status Bar Appearance
    meta(name='apple-mobile-web-app-capable', content='yes')
    meta(name='apple-mobile-web-app-status-bar-style', content='black')
    // Startup image for web apps
    link(rel='apple-touch-startup-image', href='static/img/splash/ipad-landscape.png', media='screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)')
    link(rel='apple-touch-startup-image', href='static/img/splash/ipad-portrait.png', media='screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)')
    link(rel='apple-touch-startup-image', href='static/img/splash/iphone.png', media='screen and (max-device-width: 320px)')
    link(rel='stylesheet', type='text/css', href='static/bower_components/jquery-flight-indicators/css/flightindicators.css')
    script(src='//cdn.rawgit.com/dcodeIO/protobuf.js/6.6.1/dist/protobuf.js')
    //script(src='//rawgithub.com/dcodeIO/Long.js/master/Long.min')
    //script(src='//rawgithub.com/dcodeIO/ByteBuffer.js/master/ByteBuffer.min')
    //script(src='cdn.rawgit.com/dcodeIO/ProtoBuf.js/master/dist/ProtoBuf.min.js')

    script(src='client2.js')

    script.
       var sm = new Session_Maintainance();
       var inst = new Instance();
       var dir =  new Directory();
       var page_change_counter=0;

  body.windhover-style-0
    // #HEADER
    header#header
      #logo-group
        // PLACE YOUR LOGO HERE
        span#logo
          img(src='static/img/logo-pale.png', alt='Commander')
        // END LOGO PLACEHOLDER

        // AJAX-DROPDOWN : control this dropdown height, look and feel from the LESS variable file
      // #PROJECTS: projects dropdown
      .project-context.hidden-xs.dropdown(dropdown='')
        span.label Default Instance:
        span.project-selector.dropdown-toggle(data-toggle='dropdown')
          span#yamcs-instance-selected Select
          i.fa.fa-angle-down
        ul#yamcs-instance-list.dropdown-menu
      // end projects dropdown

      #notification-group
        span#event-notification.notification
          i.fa.fa-exclamation-triangle
          b#EventCount.badge  0

        span#alarm-notification.activity-dropdown.notification
          i.fa.fa-bell
          b#AlarmCount.badge  0


      // #TOGGLE LAYOUT BUTTONS
      // pulled right: nav area
      .pull-right
        // collapse menu button
        #hide-menu.btn-header.pull-right
          span
            a(href='javascript:void(0);', data-action='toggleMenu', title='Collapse Menu')
              i.fa.fa-reorder
        // end collapse menu
        // #MOBILE
        // Top menu profile link : this shows only when top menu is active
        ul#mobile-profile-img.header-dropdown-list.hidden-xs.padding-5
          li
            a.dropdown-toggle.no-margin.userdropdown(href='#', data-toggle='dropdown')
              img.online(src='static/img/avatars/sunny.png', alt='John Doe')
            ul.dropdown-menu.pull-right
              li
                a.padding-10.padding-top-0.padding-bottom-0(href='javascript:void(0);')
                  i.fa.fa-cog
                  |  Setting
              li.divider
              li
                a.padding-10.padding-top-0.padding-bottom-0(href='#ajax/profile.html')
                  i.fa.fa-user
                  u P
                  | rofile
              li.divider
              li
                a.padding-10.padding-top-0.padding-bottom-0(href='javascript:void(0);', data-action='toggleShortcut')
                  i.fa.fa-arrow-down
                  u S
                  | hortcut
              li.divider
              li
                a.padding-10.padding-top-0.padding-bottom-0(href='javascript:void(0);', data-action='launchFullscreen')
                  i.fa.fa-arrows-alt
                  |  Full
                  u S
                  | creen
              li.divider
              li
                a.padding-10.padding-top-5.padding-bottom-5(href='login.html', data-action='userLogout')
                  i.fa.fa-sign-out.fa-lg
                  strong
                    u L
                    | ogout
        // logout button
        #logout.btn-header.transparent.pull-right
          span
            a(href='login.html', title='Sign Out', data-action='userLogout', data-logout-msg='You can improve your security further after logging out by closing this opened browser')
              i.fa.fa-sign-out
        // end logout button
        // search mobile button (this is hidden till mobile view port)
        #search-mobile.btn-header.transparent.pull-right
          span
            a(href='javascript:void(0)', title='Search')
              i.fa.fa-search
        // end search mobile button
        // #SEARCH
        // input: search field
        form.header-search.pull-right(action='#ajax/search.html')
          input#search-fld(type='text', name='param', placeholder='Find telemetry or command')
          a#cancel-search-js(href='javascript:void(0);', title='Cancel Search')
            i.fa.fa-times
        // end input: search field
        // fullscreen button
        #fullscreen.btn-header.transparent.pull-right
          span
            a(href='javascript:void(0);', data-action='launchFullscreen', title='Full Screen')
              i.fa.fa-arrows-alt
        // end fullscreen button
        // #Voice Command: Start Speech
        #speech-btn.btn-header.transparent.pull-right.hidden-sm.hidden-xs
          div
            a(href='javascript:void(0)', title='Voice Command', data-action='voiceCommand')
              i.fa.fa-microphone
            .popover.bottom
              .arrow
              .popover-content
                h4.vc-title
                  | Voice command activated
                  br
                  small Please speak clearly into the mic
                h4.vc-title-error.text-center
                  i.fa.fa-microphone-slash
                  |  Voice command failed
                  br
                  small.txt-color-red
                    | Must
                    strong "Allow"
                    |  Microphone
                  br
                  small.txt-color-red
                    | Must have
                    strong Internet Connection
                a.btn.btn-success(href='javascript:void(0);', onclick='commands.help()') See Commands
                a.btn.bg-color-purple.txt-color-white(href='javascript:void(0);', onclick="$('#speech-btn .popover').fadeOut(50);") Close Popup
        // end voice command
        // multiple lang dropdown : find all flags in the flags page
        ul.header-dropdown-list.hidden-xs
          li
            a.dropdown-toggle(href='#', data-toggle='dropdown')
              img.flag.flag-us(src='static/img/blank.gif', alt='United States')
              span  US
              i.fa.fa-angle-down
            ul.dropdown-menu.pull-right
              li.active
                a(href='javascript:void(0);')
                  img.flag.flag-us(src='static/img/blank.gif', alt='United States')
                  |  English (US)
        // end multiple lang
      // end pulled right: nav area
    // END HEADER
    // #NAVIGATION
    // Left panel : Navigation area
    // Note: This width of the aside area can be adjusted through LESS/SASS variables
    aside#left-panel.hasmenu
      // User info
      //.login-info
      //  span
      //    // User image size is adjusted inside CSS, it should stay as is
      //    a#show-shortcut(href='javascript:void(0);', data-action='toggleShortcut')
      //      img.online(src='static/img/avatars/sunny.png', alt='me')
      //      span
      //        | john.doe
      //      i.fa.fa-angle-down
      // end user info
      //  NAVIGATION : This navigation is also responsive
      //  To make this navigation dynamic please make sure to link the node
      // (the reference to the nav > ul) after page load. Or the navigation
      //  will not initialize.
      #navBox
        nav
          ul(data-path='')
            li
              a(href='flight/pilot')
                i.fa.fa-lg.fa-fw.fa-folder-o
                span.menu-item-parent  flight  /  pilot.jade
      span.hasmenu.minifyme(data-action='minifyMenu')
        i.fa.fa-arrow-circle-left.hit
    // END NAVIGATION
    // #MAIN PANEL
    #main(role='main')
      // RIBBON
      #ribbon
        span.ribbon-button-alignment
          span#refresh.btn.btn-ribbon(data-action='resetWidgets', data-title='refresh', rel='tooltip', data-placement='bottom', data-original-title="<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings.", data-html='true', data-reset-msg='Would you like to RESET all your saved widgets and clear LocalStorage?')
            i.fa.fa-refresh
        // breadcrumb
        ol.breadcrumb
        span.ribbon-button-alignment.pull-right(style="margin-right:25px")

      // #MAIN CONTENT
      #content
      // END #MAIN CONTENT
    // END #MAIN PANEL
    // #PAGE FOOTER
    //.page-footer
    //  .row
    //    .col-xs-12.col-sm-6
    //      span.txt-color-white
    //        | SmartAdmin 1.8.x
    //        span.hidden-xs  - Web Application Framework
    //        |  © 2014-2016
    //  // end row
    // END FOOTER
    #shortcut
      ul
        li
          a.jarvismetro-tile.big-cubes.bg-color-blue(href='#ajax/dashboard.html')
            span.iconbox
              i.fa.fa-envelope.fa-4x
              span
                | Mail
                span.label.pull-right.bg-color-darken 14
    // END SHORTCUT AREA

    //
    //  PACE LOADER - turn this on if you want ajax loading to show (caution: uses lots of memory on iDevices)

    // #PLUGINS
    // Link to Google CDN's jQuery + jQueryUI; fall back to local
    script(src='static/bower_components/jquery/dist/jquery.js')
    script(src='static/bower_components/jquery-ui/jquery-ui.min.js')
    // IMPORTANT: APP CONFIG
    script(src='static/js/app.config.js')
    // JS TOUCH : include this plugin for mobile drag / drop touch events
    script(src='static/bower_components/jqueryui-touch-punch/jquery.ui.touch-punch.js')
    // BOOTSTRAP JS
    script(src='static/bower_components/bootstrap/dist/js/bootstrap.js')
    // CUSTOM NOTIFICATION
    //script(src='static/js/notification/SmartNotification.js')
    // JARVIS WIDGETS
    script(src='static/js/smartwidgets/jarvis.widget.min.js')
    // EASY PIE CHARTS
    script(src='static/bower_components/jquery.easy-pie-chart/dist/jquery.easypiechart.js')
    // SPARKLINES
    script(src='static/bower_components/jquery-sparkline/dist/jquery.sparkline.js')
    // JQUERY VALIDATE
    script(src='static/bower_components/jquery-validation/dist/jquery.validate.js')
    // JQUERY MASKED INPUT
    script(src='static/bower_components/jquery.maskedinput/dist/jquery.maskedinput.js')
    // JQUERY SELECT2 INPUT
    script(src='static/bower_components/select2/dist/js/select2.js')
    // JQUERY UI + Bootstrap Slider
    script(src='static/bower_components/bootstrap-slider/bootstrap-slider.js')
    // browser msie issue fix
    script(src='static/bower_components/jquery.mb.browser/inc/jquery.mb.browser.js')
    // FastClick: For mobile devices: you can disable this in app.js
    script(src='static/bower_components/fastclick/lib/fastclick.js')
    //if IE 8
      h1
        | Your browser is out of date, please update your browser by going to www.microsoft.com/download
    // MAIN APP JS FILE
    script(src='static/js/app2.js')
    // ENHANCEMENT PLUGINS : NOT A REQUIREMENT
    // Voice command : plugin
    //script(src='static/js/speech/voicecommand.js')
    // SmartChat UI : plugin
    //script(src='static/js/smart-chat-ui/smart.chat.ui.js')
    //script(src='static/js/smart-chat-ui/smart.chat.manager.js')
    //script(src='static/js/plugin/x-editable/moment.js')
    //script(src='static/js/plugin/x-editable/jquery.mockjax.js')
    //script(src='static/js/plugin/x-editable/x-editable.js')
    // BOOTSTRAP JS
    script(src='static/bower_components/bs-context-menu/dist/BootstrapMenu.js')
    script(src='static/bower_components/Flot/jquery.flot.js')
    //script(src='static/bower_components/Flot/jquery.flot.cust.js')
    //script(src='static/bower_components/Flot/jquery.flot.resize.js')
    //script(src='static/bower_components/Flot/jquery.flot.fillbetween.js')
    //script(src='static/bower_components/Flot/jquery.flot.orderBar.js')
    //script(src='static/bower_components/Flot/jquery.flot.pie.js')
    script(src='static/bower_components/Flot/jquery.flot.time.js')
    //script(src='static/bower_components/Flot/jquery.flot.tooltip.js')
    script(src='static/bower_components/Flot/jquery.flot.threshold.js')
    //script(src='/socket.io/socket.io.js')
    script(src='static/bower_components/sprintf/dist/sprintf.min.js')
    script(src='static/bower_components/handlebars/handlebars.min.js')
    script(src='static/bower_components/jquery-flight-indicators/js/jquery.flightindicators.min.js')
    script(src='static/bower_components/svg.js/dist/svg.min.js')
    script(src='static/bower_components/eventEmitter/EventEmitter.js')
    script(src='static/bower_components/jqGrid/js/jquery.jqGrid.js')
    script(src='static/bower_components/jqGrid/js/i18n/grid.locale-en.js')
    script(src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js")
    //script(src="toolkit.js")

    // <script src="static/bower_components/jsyg-events/JSYG.Events.js"></script>
    // <script src="static/bower_components/jQuery.Hotkeys/jquery.hotkeys.js"></script>
    // <script src="static/bower_components/jsyg-stdconstruct/JSYG.StdConstruct.js"></script>
    // <script src="static/bower_components/jsyg-menu/JSYG.Menu.js"></script>
    // <script src="static/bower_components/jsyg-contextmenu/JSYG.ContextMenu.js"></script>
    // <script src="static/bower_components/zl-contextmenu/dist/zl-contextmenu.js"></script>
    // <script src="static/bower_components/ui-contextmenu/jquery.ui-contextmenu.min.js"></script>
    // <script src="static/bower_components/contextMenu/contextMenu.min.js"></script>
    // <script src="static/bower_components/jquery-ui/jquery-ui.min.js"></script>
    // <script src="static/bower_components/jquery-ui/jquery-ui.js"></script>
    // <script src="static/bower_components/angular/angular.min.js"></script>
    // <script src="static/bower_components/angular-mocks/angular-mocks.js"></script>
    // <script src="static/bower_components/contextMenu/contextMenu.min.js"></script>
    // <script src="static/bower_components/jquery/dist/jquery.min.js"></script>
    // <script src="static/bower_components/jQuery.Hotkeys/jquery.hotkeys.js"></script>
    // <script src="static/bower_components/jquery-Mustache/src/jquery.mustache.js"></script>
    // <script src="static/bower_components/jsyg-stdconstruct/JSYG.StdConstruct.js"></script>
    // <script src="static/bower_components/mustache.js/mustache.js"></script>
    // <script src="static/bower_components/ng-contextmenu/dist/ng-contextmenu.min.js"></script>
    // <script src="static/bower_components/react-contextmenu/src/contextmenu-layer.js"></script>
    // <script src="static/bower_components/ui-contextmenu/jquery.ui-contextmenu.min.js"></script>
    //#pre-loader
    .loadingGraphics(style="display:none")
        svg.drone(x='0', y='0', width='300', height='300', viewbox='-55 -40 450 420')
          path(fill='#888', d='M325.2 159.8l-0.1 0c0 0-3.3-0.5-6.4-0.1 -6.3 0.7-11.6 3.2-14.9 5.1 -1.6 0.9-2.6 1.6-2.9 1.8h-54.3v-21.5c1.6-1.1 2.6-2.9 2.6-4.9 0-2-1-3.8-2.6-4.9v-2.7H240v2.7c-1.6 1.1-2.6 2.9-2.6 4.9 0 2 1 3.8 2.6 4.9v21.5H201V148c0-2.8-1.8-5.4-4.6-7.6l0 0 46.8-82.7c0.4-0.2 1.5-0.7 3-1.6 3.3-2 8-5.5 11.8-10.5 2.1-2.8 3.1-5.7 3.1-5.7 1.9-6.5-0.9-14-4.6-16.3l-0.4-0.2c-2.6-1.7-11.5-2-16.6 4.3 0 0-2 2.3-3.2 5.6 -2.4 5.7-2.9 11.6-2.9 15.5 0 2.2 0.2 3.5 0.2 3.6l0 0.3 0.4 0.2 -43.5 76.8v-19.9c0-1.7-1.4-3.1-3.1-3.1 -1.7 0-3.1 1.4-3.1 3.1v24.2c-7.8-3-12.8-3.9-15.6-3.9 -2.6 0-9.8 1.6-16.8 4.4v-24.6c0-1.7-1.4-3.1-3.1-3.1s-3.1 1.4-3.1 3.1v19.9l-43.3-76 0.4-0.2 0-0.3c0-0.1 0.2-1.4 0.2-3.6 0-3-0.5-7.2-1.8-11.7 -0.3-1.2-0.7-2.5-1.2-3.8C99 30.3 97 28.4 97 28.4 92.7 23 83.9 22 80.2 24.1c-3.9 2.2-6.8 9.9-4.8 16.5 0 0 0.9 3 3.1 5.7 3.7 5.1 8.5 8.5 11.8 10.4 1.5 0.9 2.6 1.4 3 1.6l47.1 82.6c-2.3 2.1-3.8 4.4-3.8 7v18.6H97.7V145c1.6-1.1 2.6-2.9 2.6-4.9 0-2-1-3.8-2.6-4.9v-2.7h-6.6v2.7c-1.6 1.1-2.6 2.9-2.6 4.9 0 2 1 3.8 2.6 4.9v21.5H36.8c-0.3-0.2-1.3-0.9-2.9-1.8 -3.4-1.9-8.7-4.4-14.9-5.1 0 0-3.2-0.4-6.5 0.1 -6.7 1.6-11.9 7.9-11.9 12.4 0 4.2 3.8 11.1 12 12.5 2.6 0.4 6.5 0 6.5 0 6.2-0.7 11.5-3.2 14.9-5.1 1.9-1.1 3-1.9 3-1.9l0.2-0.2V177h54v40.6l0 22.4c-1.6 1.1-2.7 3-2.7 4.9 0 1.9 1.1 3.5 2.7 4.6l0 1.7h6.6v-1.7c1.6-1.1 2.7-2.7 2.7-4.6 0-1.9-1.1-3.8-2.7-4.9v-22.4h2.3l4.9-7.9 0 0h22.6l0 0c-0.4 1.1-0.5 2.1-0.2 3.2 0.4 1.5 1.7 2.8 4 4 0.3 0.1 0.5 0.3 0.8 0.4l-38.1 67.2 -0.4-0.2 -0.2 0.1c-0.1 0-1.3 0.6-3.2 1.7 -3.3 2-8.1 5.4-11.8 10.4 0 0-1.6 1.4-3.2 5.7 -2.8 7.8 1.3 14.5 5 16.6 1.2 0.7 2.7 1 4.5 1 4 0 8.9-1.8 12.2-5.3 0 0 2.1-2.4 3.3-5.6 2.5-5.8 2.9-11.6 2.9-15.5 0-1.8-0.1-3-0.2-3.4l37.8-66.7c0.7 1.1 1.2 2.4 1.5 3.9 0.9 6.6 4.2 30.1 5.5 36.3 0.9 4.2 2 7.6 8.3 9.3 3 0.8 7.2 1.2 13 1.2h0.1 0c5.3 0 9.3-0.4 12.3-1 6.9-1.6 8.1-5.1 9-9.5 1.2-6.2 4.6-29.7 5.5-36.3 0.2-1.5 0.7-2.7 1.3-3.7l37.7 66.2c0 0.4-0.2 1.6-0.2 3.4 0 3.9 0.5 9.7 3 15.5 0 0 1.3 3.1 3.3 5.6 3.2 3.5 8.2 5.3 12.1 5.3 1.7 0 3.2-0.3 4.4-0.9l0.1-0.1c3.7-2.1 7.8-8.8 4.9-16.6 0 0-0.9-3.2-3.2-5.7 -3.7-5-8.4-8.4-11.8-10.4 -1.9-1.1-3.1-1.6-3.2-1.7L244 284l-0.4 0.2 -38.1-66.8c0.3-0.2 0.7-0.3 1-0.5 2.3-1.2 3.5-2.5 4-4 0.3-1 0.2-2.1-0.2-3.1h22.6l0 0 4.9 7.9h2.3v22.4c-1.6 1.1-2.7 3-2.7 4.9 0 1.9 1.1 3.5 2.7 4.6v1.7h6.6l0-1.7c1.6-1.1 2.7-2.7 2.7-4.6 0-1.9-1.1-3.8-2.7-4.9l0-22.4V177h54v0.5l0.2 0.2c0 0 1.1 0.9 3 1.9 3.4 1.9 8.7 4.4 14.9 5.1 3.1 0.6 6.5 0 6.5 0 8.2-1.4 12-8.3 12-12.5C337.2 167.7 332 161.3 325.2 159.8zM105.1 200.9l-5.1-7.5h-2.3V177h38.9v0.7l0 0.7 0.7 0.2c0.3 0.1 2.7 0.7 2.7 3.7 0 2.9-2.4 3.5-2.7 3.6l-0.8 0.2 0.1 0.8c0 0 0.5 4.9-1.4 8.3 -0.8 1.5-1.7 3.1-2.5 4.7 -0.2 0.4-0.4 0.7-0.6 1.1H105.1zM240 193.5h-2.3l-5.1 7.5h-27c-0.2-0.3-0.3-0.7-0.5-1 -0.9-1.7-1.8-3.4-2.6-4.9 -1.9-3.4-1.4-8.3-1.4-8.3l0.1-0.8 -0.8-0.2c-0.3-0.1-2.7-0.7-2.7-3.6 0-3 2.4-3.6 2.7-3.6l0.7-0.1V177H240V193.5z')
          path.blade(fill='#999', d='M325.3 183.1c4.8-1.3 8.3-5.7 8.3-10.9 0-5.1-3.4-9.5-8.2-10.9 0.5-2.8 2.7-17.4 1.7-32.8 -1.2-17.1-2-21.7-4.3-23.6 -0.7-0.6-1.5-1-2.2-1 -2.5 0-4.2 3.7-5.3 11.5 -1.8 12.4-3.5 27.9 0 37.2l3.3 8.8c-4.5 1.5-7.8 5.8-7.8 10.8 0 4.9 3.2 9.1 7.6 10.7 -0.4 2.3-2.8 17.2-1.7 33 1.2 17.1 2 21.7 4.3 23.6 0.7 0.6 1.5 1 2.2 1 2.5 0 4.2-3.7 5.3-11.5 1.8-12.4 3.5-27.9 0-37.2L325.3 183.1z')
          path.blade(fill='#999', d='M308 271c-0.5-0.2-1.1-0.3-1.7-0.3 -2.9 0-8 2-21 8.3 -14.3 6.9-26.1 16.4-27.9 17.8 -2-1.8-4.6-2.8-7.4-2.8 -2 0-3.9 0.5-5.6 1.5 -2.6 1.5-4.5 3.9-5.3 6.9 -0.5 1.7-0.5 3.5-0.2 5.2l-9.3 1.5c-9.8 1.6-22.5 10.7-32.4 18.4 -5.4 4.3-7.9 7.4-7.6 9.5 0.2 1 0.9 1.7 2.2 2.2 0.5 0.2 1.1 0.3 1.7 0.3 2.9 0 8-2 21-8.3 13.9-6.7 25.5-15.9 27.7-17.7 2.1 2 4.9 3.2 7.9 3.2 2 0 3.9-0.5 5.6-1.5 2.6-1.5 4.5-3.9 5.3-6.9 0.5-1.9 0.5-3.9 0-5.8l9.2-1.5c9.8-1.6 22.5-10.7 32.4-18.4 5.4-4.3 7.9-7.4 7.6-9.5C310 272.2 309.2 271.5 308 271z')
          path.blade(fill='#999', d='M140.3 327.8c-9.9-7.7-22.6-16.8-32.4-18.3l-9.3-1.5c0.3-1.7 0.3-3.5-0.2-5.2 -0.8-2.9-2.7-5.4-5.3-6.9 -1.7-1-3.6-1.5-5.6-1.5 -2.8 0-5.4 1-7.4 2.8 -1.7-1.4-13.6-10.9-27.9-17.8 -13-6.2-18.1-8.2-21-8.2 -0.6 0-1.2 0.1-1.7 0.3 -1.3 0.5-2 1.2-2.2 2.2 -0.3 2.2 2.1 5.3 7.6 9.5 9.9 7.7 22.6 16.8 32.4 18.3l9.2 1.4c-0.5 1.9-0.5 3.9 0.1 5.8 0.8 2.9 2.7 5.4 5.3 6.9 1.7 1 3.6 1.5 5.6 1.5 3 0 5.8-1.2 7.9-3.2 2.2 1.8 13.8 11 27.7 17.6 13 6.2 18.1 8.2 21 8.2 0.6 0 1.2-0.1 1.7-0.3 1.3-0.5 2-1.2 2.2-2.2C148.3 335.1 145.8 332 140.3 327.8z')
          path.blade(fill='#999', d='M19 161.4l3.3-8.8c3.5-9.3 1.8-24.8 0-37.2 -1.1-7.7-2.9-11.5-5.4-11.5 -0.7 0-1.4 0.3-2.2 1 -2.3 1.9-3.1 6.6-4.3 23.6 -1 15.4 1.2 30 1.7 32.8 -4.7 1.4-8.2 5.7-8.2 10.9 0 5.2 3.5 9.6 8.4 10.9l-3.3 8.7c-3.5 9.3-1.8 24.8 0 37.2 1.1 7.7 2.9 11.5 5.4 11.5 0.7 0 1.4-0.3 2.2-1 2.3-1.9 3.1-6.6 4.3-23.6 1.1-15.8-1.3-30.8-1.7-33 4.4-1.6 7.6-5.8 7.6-10.7C26.8 167.1 23.5 162.9 19 161.4z')
          path.blade(fill='#999', d='M146.3 2.1c-1.5-1.8-5.5-1.3-12.4 1.4 -11.7 4.6-26 10.8-32.3 18.5l-5.9 7.1c-2.1-2.1-5-3.3-8-3.3 -2 0-3.9 0.5-5.6 1.5 -4.5 2.5-6.5 7.7-5.4 12.5 -2.7 1-16.5 6.3-29.3 14.8C33 64 29.4 67 28.8 69.9c-0.2 1.1-0.1 2 0.5 2.7 0.6 0.7 1.6 1.1 3 1.1h0c2.1 0 5.3-0.8 9.4-2.4 11.7-4.6 26-10.8 32.3-18.5l6.1-7.3c2.1 1.9 4.7 2.9 7.6 2.9 2 0 3.9-0.5 5.6-1.5 4.3-2.4 6.4-7.3 5.5-11.9 2.1-0.8 16.3-6.1 29.5-14.9 14.3-9.5 17.9-12.5 18.4-15.4C147 3.7 146.8 2.8 146.3 2.1z')
          path.blade(fill='#999', d='M307.9 69c-0.6-2.9-4.2-5.9-18.5-15.4C276.5 45.2 262.7 39.9 260 39c1.1-4.8-1-9.9-5.5-12.5 -1.7-1-3.6-1.5-5.6-1.5 -3.1 0-5.9 1.2-8.1 3.3l-5.9-7.1c-6.4-7.6-20.7-13.8-32.4-18.4 -6.8-2.7-10.9-3.1-12.4-1.3 -0.5 0.6-0.7 1.6-0.5 2.7 0.6 2.9 4.2 5.9 18.5 15.4 13.2 8.7 27.4 14 29.6 14.8 -0.3 1.6-0.2 3.3 0.2 5 0.8 2.9 2.7 5.4 5.3 6.9 1.7 1 3.6 1.5 5.6 1.5 2.9 0 5.6-1.1 7.6-3l6.1 7.3c6.4 7.6 20.7 13.8 32.4 18.4 4.1 1.6 7.2 2.4 9.4 2.4 1.4 0 2.4-0.4 3-1.1C308 71.1 308.1 70.2 307.9 69z')
        p.loadingText loading


    script.


      /*This Event happens on page reload*/

      window.onload= function(){
        sm.unSubscribeAll();
        sm.cleanSlate();
        //sm = new Telemetry(); //idk if this line is needed.
        //session.saveSockets([inst,dir,cmd_o,sm,sm]);
      };



      /*This event happens just before the page is closed or unloaded*/

      window.onbeforeunload = function () {

       sm.killAll();
       sm.eventKill();
      };




      /*This event happens when browser detects url change*/

      window.onhashchange= function(){
        //var newInstance = session.getCurrentInstance();
        //sm.unSubscribe();
        sm.cleanSlate();
        if($("#yamcs-instance-selected").text() != 'Select'){
        page_change_counter = page_change_counter+1;}
      };



      // INSTANCES
      inst.getInstanceList(processInstance);


      // EVENTS
      sm.eventSubscription(function(event) {
        var eventCount = parseInt($('#EventCount').text());
        eventCount++;
        $('#EventCount').text(eventCount);
        $('#EventCount').addClass("bg-color-red bounceIn animated");
      });

      function processInstance(instances) {
          console.log('processInstance 2');
          instances = JSON.parse(instances.data);
          console.log('-------------',instances);
          $("#yamcs-instance-list").text('');
            $.each(instances.instance, function (i, selected) {
              $("#yamcs-instance-list").append(
                $('<li>').append(
                  $('<a>').attr('href', 'javascript:void(0);').on("click", function (item) {
                    //sm.transmitCurrentInstance(item.target.text)
                    //session.setCurrentInstance(item.target.text);
                    //var newInstance = session.getCurrentInstance();
                    page_change_counter=0;
                    $("#yamcs-instance-selected").text(item.target.text);

                    sm.transmitCurrentInstance(item.target.text);
                    sleep(100);// TODO: instance name is not written onto the messages when this step is executed there for a significant delay added
                    BindHtmlToCommanderInstance(item.target.text); //first time binding



                  }).append(selected.name)));
            });
            console.log('processInstance 1');
            getWorkspaceDir('');
        }




      var CommanderTlmDataElements = [];//TODO

      var procDirectoryListing = function (listing) {
        /* Add 'url', and 'ext' attributes */
        console.log('proc dir list');
        listing = JSON.parse(listing.data);
        for (var i = 0; i < listing.files.length; i++) {
          var path = listing.files[i].path;
          var subpath;
          var subname;
          var ext;
          var name = listing.files[i].name;
          subpath = path.substring(0, path.lastIndexOf("/") + 1);
          var a = listing.files[i].path.split('.');
          if (a.length === 1 || ( a[0] === '' && a.length === 2 )) {
            ext = '';
          }

          ext = a.pop();
          /* Prepend 'view' to the path to make the URL and cut off the jade extension. */
          if (ext == '') {
            listing.files[i].url =  path;
          } else {
            if (ext == 'js') {
              listing.files[i].url = '/scripting/index?url=ws' + path;
            } else {
              listing.files[i].url =  path;
            }
          }
          listing.files[i].ext = ext;
        }
        updateNavBar(listing);
        addNavMenu();
      };



      var trimNull = function (a) {
        var c = a.indexOf('\0');
        if (c>-1) {
          return a.substr(0, c);
        }
        return a;
      }



      /*BENCHMARKING FUNCTION*/
      /*
      var avg_list = []
      var count = 0
      var ws = new WebSocket('ws://localhost:7000');
      ws.onopen = function () {
          ws.send("connected");
      };
      ws.onclose = function(){
          ws.close();
      }
      ws.onmessage=function(e){
          console.log('msg: ',e)
      }
      */
      /*BENCHMARKING FUNCTION*/




      var processTelemetryUpdate = function (param) {

         /*BENCHMARKING FUNCTION*/
         /*
            count = count + 1 ;
            var time_now = Date.now()  ;
            var gen_time = new Date(param.acquisitionTimeUTC);
            latency = time_now-gen_time.getTime();

            //{"latency":latency,"recv_time":time_now,"sent_time":gen_time,"counter":count,"from":"SOCKETIO"}
            avg_list.push(time_now-gen_time.getTime())
            var sum = avg_list.reduce((previous, current) => current += previous);
            var avg = sum / avg_list.length;
            var dict = "SOCKETIO,"+latency+","+avg+","+count+","+time_now+","+gen_time


            if (ws.readyState == WebSocket.OPEN) {
              ws.send(JSON.stringify(dict));
              //console.log(avg);
            };
        */
        /*BENCHMARKING FUNCTION*/
        var found = false;
        for (var i = 0; i < CommanderTlmDataElements.length; i++) {
          pre_process = CommanderTlmDataElements[i].attr('data-sage');
          pre_process = pre_process.replace(/'/g, '"');
          var jsonObj = JSON.parse(pre_process);
          for (var j = 0; j < jsonObj.tlm.length; j++) {
            if (jsonObj.tlm[j].name == param.id.name){

              var correctInstance = false;
              if(jsonObj.hasOwnProperty('instance') && (jsonObj.instance == param.instance)) {
                correctInstance = true;

              } else {
                if(param.instance == $("#yamcs-instance-selected").text()){
                  correctInstance = true;

                }

              }

              found = true;
              if(correctInstance == true){
                var value;
                if (param.engValue.hasOwnProperty('floatValue')) {
                  /* TODO */
                  value = param.engValue.floatValue;
                } else if (param.engValue.hasOwnProperty('doubleValue')) {
                  /* TODO */
                  value = param.engValue.doubleValue;
                } else if (param.engValue.hasOwnProperty('sint32Value')) {
                  /* TODO */
                  value = param.engValue.sint32Value;
                } else if (param.engValue.hasOwnProperty('uint32Value')) {
                  /* TODO */
                  value = param.engValue.uint32Value;
                } else if (param.engValue.hasOwnProperty('binaryValue')) {
                  /* TODO */
                  value = param.engValue.binaryValue;
                } else if (param.engValue.hasOwnProperty('stringValue')) {
                  /* TODO */
                  value = trimNull(param.engValue.stringValue);
                } else if (param.engValue.hasOwnProperty('timestampValue')) {
                  /* TODO */
                  value = param.engValue.timestampValue;
                } else if (param.engValue.hasOwnProperty('uint64Value')) {
                  /* TODO */
                  value = param.engValue.uint64Value;
                } else if (param.engValue.hasOwnProperty('sint64Value')) {
                  /* TODO */
                  value = param.engValue.sint64Value;
                } else if (param.engValue.hasOwnProperty('booleanValue')) {
                  /* TODO */
                  value = param.engValue.booleanValue;
                } else {
                  /* TODO */
                  value = '???';
                }

                if(CommanderTlmDataElements[i].is(':checkbox')) {
                  if((value == true) || (value > 0.0))
                    CommanderTlmDataElements[i].prop( "checked", true );
                  else
                    CommanderTlmDataElements[i].prop( "checked", false );
                } else if(CommanderTlmDataElements[i].is('input')) {

                  CommanderTlmDataElements[i].prop( "value", value );
                } else {
                  if (jsonObj.tlm[j].hasOwnProperty('format')) {
                    value = sprintf(jsonObj.tlm[j].format, value);
                  }

                  CommanderTlmDataElements[i].text(value);
                }

                /* Set the data validity timer, if timeout is specified. */
                if(param.hasOwnProperty('expirationTime')){
                  var tlmObj = CommanderTlmDataElements[i];

                  /* Expiration time is set.  Check if we already have a timer set. */
                  if(CommanderTlmDataElements[i].hasOwnProperty('timeout')){
                    /* Yes, one is already set.  Clear it first. */
                    clearTimeout(CommanderTlmDataElements[i].timeout);

                    /* Remove the timeout class, if it has one. */
                    tlmObj.removeClass('tlm-timedout');
                  }

                  /* Now set a new timeout. */
                  var timeout = param.expirationTime - param.acquisitionTime;
                  CommanderTlmDataElements[i].timeout = setTimeout(function () {
                    /* Telemetry timed out. */
                    tlmObj.addClass('tlm-timedout');
                  }, timeout);
                }
              }
            }
          }
        }
        if (found == false) {

          //console.log(param.id.name);
          sm.unSubscribeTelemetry({'tlm':[{'name':param.id.name}]});


        }
      };




      var replaceAll=function(str, find, replace) {
            var str = str.toString();
            return str.replace(new RegExp(find, 'g'), replace);
        }




      var BindHtmlToCommanderInstance = function (instanceName) {
        //sleep(1000);
        sm.loadGraphics()
        var tlm = [];
        var self = this;

        console.log('Application #',page_change_counter+1);
        if(page_change_counter>=1){

            console.log('called all unsubscription');
            //sm.unSubscribeAll2();


        }


        CommanderTlmDataElements.length = 0;
        $('[data-sage]').each(function () {

          var obj = $(this).attr('data-sage');
          var jsonObj;


          if (typeof obj === 'string' || obj instanceof String) {
            // it's a string
            obj= replaceAll(obj,"\'","\"");
            try{
                jsonObj = JSON.parse(obj);
                }
            catch(err){
                log('ERROR','cannot parse string from data-sage.',err);
                return;
            }
          }
          else if (typeof obj === 'object' || obj instanceof Object) {
            // it's an object
            jsonObj = obj;
          }
          else {
            // it's something else
            return;

          }


          if (jsonObj.hasOwnProperty('tlm')) {
            /* This is a telemetry object. */
            sm.subscribeTelemetry(jsonObj,processTelemetryUpdate);
            CommanderTlmDataElements.push($(this));
          }


          if (jsonObj.hasOwnProperty('cmd')) {
            /* This is a command object. */

            var cmdObj = jsonObj.cmd;
            var btnObj = $(this);
            try{
                sm.prepareCmds(cmdObj.name,jsonObj,btnObj);
            }
            catch(err){
                log('ERROR','cannot parse command string from data-sage.',err);

            }

          }



        });




        //Do Your Moves Here

        var c = 0;
        sm.ProcessCmds(function(cmdInfoStr,jsonObj,btnObj){


          c = c+1
          var cmdObj = jsonObj.cmd;
          var cmdData = cmdInfoStr.data;
          cmdData = replaceAll(cmdData,"\'","\"");
          var cmdInfo;

          try {
              cmdInfo = JSON.parse(cmdData);
          } catch (e) {
              /* TODO:  This is not a valid JSON object, probably because the
                 command itself is not valid.  We need to add a console so we
                 can present these errors to the user. */
              return;
          }

          if (cmdObj.hasOwnProperty('uuid')) {
            /* We already bound this element. */
          } else {
            if ((cmdObj.name == cmdInfo.qualifiedName) &&
                (cmdObj.instance == cmdInfo.instance)) {
              var uuid = generateUUID();
              cmdInfo.uuid = uuid;
              cmdObj.uuid = uuid;
              btnObj.attr('data-sage', JSON.stringify(jsonObj));
              /* Copy any arguments we have from the command button into the cmdInfo struct. */
              if (cmdObj.hasOwnProperty('argument')) {
                for (i = 0; i < cmdObj.argument.length; i++) {
                  for (j = 0; j < cmdInfo.argument.length; j++) {
                    if (cmdInfo.argument[j].name == cmdObj.argument[i].name) {
                      cmdInfo.argument[j].value = cmdObj.argument[i].value;
                    }
                  }
                }
              }

              var cmdOut = JSON.parse(JSON.stringify(cmdInfo));

              if(isTemplateCommand(cmdOut) == false) {

                btnObj.click(function (eventObject) {
                  if (cmdOut.hasOwnProperty('argument')) {
                    var args = [];
                    for (i = 0; i < cmdOut.argument.length; i++) {
                      args.push({name: cmdOut.argument[i].name, value: cmdOut.argument[i].value});
                    }

                    sm.sendCommand(cmdOut.qualifiedName, args);//TODO

                  } else {

                    sm.sendCommand(cmdOut.qualifiedName, []);//TODO

                  }
                });
              } else {
                /* First, generate UUIDs to be used later as element IDs. */
                for (i = 0; i < cmdOut.argument.length; i++) {
                  cmdOut.argument[i].uuid = uuid + "_" + cmdOut.argument[i].name;
                }
                /* Next set stringLength for string parameters to be used for form validation later. */
                for (i = 0; i < cmdOut.argument.length; i++) {
                  if (cmdOut.argument[i].type == "STRING") {
                    /* Add a new stringLength (in bytes) attribute for parameter validation later. */
                    cmdOut.argument[i].stringLength = cmdOut.argument[i].type.dataEncoding.sizeInBits / 8;
                  }
                }
                var source = $.trim($('#cmdTemplate').html());
                var template = Handlebars.compile(source);
                var html = template(cmdOut);
                var dlg = $("<div id='" + uuid + "'></div>")
                  .append(html);
                // Modal Link
                btnObj.click(function () {
                  dlg.dialog('open');
                  return false;
                });
                $(dlg).dialog({
                  autoOpen: false,
                  modal: true,
                  html: true,
                  content: html,
                  buttons: [
                    {
                      html: "Cancel",
                      "class": "btn btn-default",
                      click: function () {
                        $(this).dialog("close");
                      }
                    },
                    {
                      html: "<i class='fa fa-check'></i>&nbsp; Send",
                      "class": "btn btn-primary",
                      click: function () {
                        var args = [];
                        for (i = 0; i < cmdOut.argument.length; i++) {
                          if (cmdOut.argument[i].type.engType == 'enumeration') {
                            args.push({
                              'name': cmdOut.argument[i].name,
                              'value': $('#' + cmdOut.argument[i].uuid + ' option:selected').text()
                            });
                          } else {
                            args.push({
                              'name': cmdOut.argument[i].name,
                              'value': $('#' + cmdOut.argument[i].uuid).val()
                            });
                          }
                        }
                        $(this).dialog(sm.sendCommand(cmdOut.qualifiedName, args));//TODO
                        $(this).dialog("close");
                      }
                    }
                  ]
                });
              }
            }
          }
        });
      };


      var setupEventSummaryDisplay = function () {
        var event_summary_jqgrid_data = [{
          time: '12:00:01.000',
          src : 'SCH',
          id: 123,
          sev : 'DEBUG'
        },{
          time: '12:00:02.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:03.000',
          src : 'SCH',
          id: 123,
          sev : 'ERROR'
        },{
          time: '12:00:04.000',
          src : 'SCH',
          id: 123,
          sev : 'CRIT'
        },{
          time: '12:00:05.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:06.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:07.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:08.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:09.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:10.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        },{
          time: '12:00:10.000',
          src : 'SCH',
          id: 123,
          sev : 'INFO'
        }];

        jQuery("#event_summary_jqgrid").jqGrid({
          data : event_summary_jqgrid_data,
          datatype : 'local',
          height : 'auto',
          colNames : ['Severity', 'Time', 'Source', 'ID'],
          colModel : [{
            name : 'sev',
            index : 'sev',
            sortable : true,
            editable : false,
            align : 'left',
            width : 60
          }, {
            name : 'time',
            index : 'time',
            sortable : true,
            editable : false,
            align : 'left'
          }, {
            name : 'src',
            index : 'src',
            sortable : true,
            editable : false,
            align : 'left',
            width : 60
          }, {
            name : 'id',
            index : 'id',
            sortable : true,
            editable : false,
            align : 'left',
            width : 30
          }],
          rowNum : 10,
          rowList : [10, 20, 30],
          pager : '#event_summary_pjqgrid',
          sortname : 'time',
          toolbarfilter : true,
          viewrecords : true,
          sortorder : 'asc',
          gridComplete : function() {
            var ids = jQuery('#event_summary_jqgrid').jqGrid('getDataIDs');
            for (var i = 0; i < ids.length; i++) {
              var cl = ids[i];
              be = "<button class='btn btn-xs btn-default' data-original-title='Edit Row' onclick=\"jQuery('#event_summary_jqgrid').editRow('" + cl + "');\"><i class='fa fa-pencil'></i></button>";
              se = "<button class='btn btn-xs btn-default' data-original-title='Save Row' onclick=\"jQuery('#event_summary_jqgrid').saveRow('" + cl + "');\"><i class='fa fa-save'></i></button>";
              ca = "<button class='btn btn-xs btn-default' data-original-title='Cancel' onclick=\"jQuery('#event_summary_jqgrid').restoreRow('" + cl + "');\"><i class='fa fa-times'></i></button>";
              //ce = "<button class='btn btn-xs btn-default' onclick=\"jQuery('#event_summary_jqgrid').restoreRow('"+cl+"');\"><i class='fa fa-times'></i></button>";
              //jQuery('#event_summary_jqgrid').jqGrid('setRowData',ids[i],{act:be+se+ce});
              jQuery('#event_summary_jqgrid').jqGrid('setRowData', ids[i], {
                act : be + se + ca
              });
            }
          },
          editurl : 'dummy.html',
          multiselect : false,
          autowidth : true,
        });

        jQuery('#event_summary_jqgrid').jqGrid('navGrid', '#event_summary_pjqgrid', {
          edit : false,
          add : false,
          del : false,
          search : false,
          refresh : false
        });
        jQuery('#event_summary_jqgrid').jqGrid('inlineNav', '#event_summary_pjqgrid');
        /* Add tooltips */
        $('.navtable .ui-pg-button').tooltip({
          container : 'body'
        });
      };

      var setupAlarmSummaryDisplay = function () {
        var alarm_summary_jqgrid_data = [{
          name: '/CFS/HS/UtilCpuAvg',
          acqTime: '12:00:01.000',
          actLevel : 2,
          highestLevel: 4,
          currentLevel : 2
        },{
          name: '/CFS/HS/UtilCpuAvg',
          acqTime: '12:00:01.000',
          actLevel : 2,
          highestLevel: 4,
          currentLevel : 2
        },{
          name: '/CFS/HS/UtilCpuAvg',
          acqTime: '12:00:01.000',
          actLevel : 2,
          highestLevel: 4,
          currentLevel : 2
        }];

        var outerwidth = $("#alarm-notification-dropdown").width();
        jQuery("#alarm_summary_jqgrid").jqGrid({
          data : alarm_summary_jqgrid_data,
          datatype : 'local',
          height : 'auto',
          colNames : ['Name', 'Acq Time', 'Activation', 'Highest', 'Current'],
          colModel : [{
            name : 'name',
            index : 'name',
            sortable : true,
            editable : false,
            align : 'left'
          }, {
            name : 'acqTime',
            index : 'acqTime',
            sortable : true,
            editable : false,
            align : 'left',
            width : 150
          }, {
            name : 'actLevel',
            index : 'actLevel',
            sortable : true,
            editable : false,
            align : 'left',
            width : 60
          }, {
            name : 'highestLevel',
            index : 'highestLevel',
            sortable : true,
            editable : false,
            align : 'left',
            width : 60
          }, {
            name : 'currentLevel',
            index : 'currentLevel',
            sortable : true,
            editable : false,
            align : 'left',
            width : 60
          }],
          rowNum : 10,
          rowList : [10, 20, 30],
          pager : '#alarm_summary_pjqgrid',
          sortname : 'time',
          toolbarfilter : true,
          viewrecords : true,
          sortorder : 'asc',
          gridComplete : function() {
            var ids = jQuery('#event_summary_jqgrid').jqGrid('getDataIDs');
            for (var i = 0; i < ids.length; i++) {
              var cl = ids[i];
              be = "<button class='btn btn-xs btn-default' data-original-title='Edit Row' onclick=\"jQuery('#alarm_summary_jqgrid').editRow('" + cl + "');\"><i class='fa fa-pencil'></i></button>";
              se = "<button class='btn btn-xs btn-default' data-original-title='Save Row' onclick=\"jQuery('#alarm_summary_jqgrid').saveRow('" + cl + "');\"><i class='fa fa-save'></i></button>";
              ca = "<button class='btn btn-xs btn-default' data-original-title='Cancel' onclick=\"jQuery('#alarm_summary_jqgrid').restoreRow('" + cl + "');\"><i class='fa fa-times'></i></button>";
              //ce = "<button class='btn btn-xs btn-default' onclick=\"jQuery('#alarm_summary_jqgrid').restoreRow('"+cl+"');\"><i class='fa fa-times'></i></button>";
              //jQuery('#alarm_summary_jqgrid').jqGrid('setRowData',ids[i],{act:be+se+ce});
              jQuery('#alarm_summary_jqgrid').jqGrid('setRowData', ids[i], {
                act : be + se + ca
              });
            }
          },
          editurl : 'dummy.html',
          multiselect : false,
          autowidth: true,
          shrinkToFit: true,
          width: outerwidth
        });
        $("#alarm_summary_jqgrid").jqGrid('setGridWidth', 468);

        //jQuery('#alarm_summary_jqgrid').jqGrid('navGrid', '#alarm_summary_pjqgrid', {
        //  edit : false,
        //  add : false,
        //  del : false,
        //  search : false,
        //  refresh : false
        //});
        //jQuery('#alarm_summary_jqgrid').jqGrid('inlineNav', '#alarm_summary_pjqgrid');
        ///* Add tooltips */
        //$('.navtable .ui-pg-button').tooltip({
        //  container : 'body'
        //});

        //$(window).on('resize.jqGrid', function() {
        //  $("#alarm_summary_jqgrid").jqGrid('setGridWidth', $("#alarm_summary_jqgrid").parent().width());
        //})
      };

      var navBarEmpty = true;
      $(document).ready(function(){
        Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {
          switch (operator) {
            case '==':
              return (v1 == v2) ? options.fn(this) : options.inverse(this);
            case '===':
              return (v1 === v2) ? options.fn(this) : options.inverse(this);
            case '<':
              return (v1 < v2) ? options.fn(this) : options.inverse(this);
            case '<=':
              return (v1 <= v2) ? options.fn(this) : options.inverse(this);
            case '>':
              return (v1 > v2) ? options.fn(this) : options.inverse(this);
            case '>=':
              return (v1 >= v2) ? options.fn(this) : options.inverse(this);
            case '&&':
              return (v1 && v2) ? options.fn(this) : options.inverse(this);
            case '||':
              return (v1 || v2) ? options.fn(this) : options.inverse(this);
            default:
              return options.inverse(this);
          }
        });
      });


      function isTemplateCommand(commandInfo) {
        if(commandInfo.hasOwnProperty('argument')){
          if(commandInfo.argument.length == 0){
            return false;
          } else {
            var found = false;
            /* Look for at least 1 unspecified value. */
            for(i=0; i < commandInfo.argument.length; i++){
              if(!commandInfo.argument[i].hasOwnProperty('value')){
                found = true;
              }
            }
            return found;
          }
        } else {
          return false;
        }
      }
      var generateUUID = function(){
        var d = new Date().getTime();
        if(window.performance && typeof window.performance.now === "function"){
          d += performance.now(); //use high-precision timer if available
        }
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = (d + Math.random()*16)%16 | 0;
          d = Math.floor(d/16);
          return (c=='x' ? r : (r&0x3|0x8)).toString(16);
        });
        return uuid;
      }
      function getWorkspaceDir(s){
        console.log('get wrokspace sir');
        dir.getDirectoryListing(s,procDirectoryListing);

      };
      function getNavEntry(path){
        return $( "nav" ).find( "ul[data-path='" + path + "']" );
      };



      function updateNavBar(listing) {
        console.log('update nav');
        /*html = ''
        console.log(listing);
        for(var i =0; i<listing.files.length; i++){
            console.log(listing.files[i]);
            if(listing.files[i].type =='dir'){
                html+="<li class=\"\"><a href=\"#\" onclick=\"getWorkspaceDir("+listing.files[i].path+");\"><i class=\"fa fa-lg fa-fw fa-folder-o\"></i> <span class=\"menu-item-parent\">"+listing.files[i].name+"</span></a><ul data-path="+listing.files[i].path+"></ul></li>"
            }
            else{
            var icon =''

            if(listing.files[i].ext == 'jade'){
            icon = "fa icon-html"
            }else if(listing.files[i].ext == 'pug'){
            icon = "fa icon-html"
            }
            else if(listing.files[i].ext == 'html'){
            icon = "fa icon-html"
            }
            else if(listing.files[i].ext == 'js'){
            icon = "fa icon-javascript-alt"
            }
            else if(listing.files[i].ext == 'py'){
            icon = "fa icon-python-alt"
            }
            else if(listing.files[i].ext == 'pyc'){
            icon = "fa icon-python-alt"
            }
            html+="<li><a href=\""+listing.files[i].url+"\"title=\""+listing.files[i].name+"\"><i class=\""+icon+"\"></i>"+listing.files[i].name+"</a></li>"

            }
        }*/


        var source = $.trim($('#navBarTemplate').html());
        var template = Handlebars.compile(source);
        var html = template(listing);
        //console.log(html)
        var tgtObj = getNavEntry(listing.path);

        tgtObj.html('');

        tgtObj.append(html);

        tgtObj.removeClass('jarvis-menu-applied');

        initApp.leftNav();
      };

      function addNavMenu() {
        var menu = new BootstrapMenu('#left-panel', {
          fetchElementData: function($rowElem) {
          },
          /* group actions by their id to make use of separators between
           * them in the context menu. Actions not added to any group with
           * this option will appear in a default group of their own. */
          actionsGroups: [
            ['newFolder', 'newDisplay', 'newScriptJS', 'newScriptPy' ],
            ['openFile', 'editFile'],
            ['copyFile', 'pasteFile', 'deleteFile', 'renameFile', 'moveFile']
          ],
          /* you can declare 'actions' as an object instead of an array,
           * and its keys will be used as action ids. */
          actions: {
            newFolder: {
              name: 'New Folder',
              iconClass: 'fa-folder-o',
              onClick: function() {
                console.log("'New Folder' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            newDisplay: {
              name: 'New Display',
              iconClass: 'fa-tachometer',
              onClick: function() {
                console.log("'New Display' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            newScriptJS: {
              name: 'New JS Script',
              iconClass: 'icon-javascript',
              onClick: function() {
                console.log("'New JS Script' clicked.");
              },
              isShown: function() {
                return true;
              }
            },
            newScriptPy: {
              name: 'New Py Script',
              iconClass: 'icon-python',
              onClick: function() {
                console.log("'New Py Script' clicked.");
              },
              isShown: function() {
                return true;
              }
            },
            openFile: {
              name: 'Open',
              iconClass: 'fa-eye',
              onClick: function() {
                console.log("'Open' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            editFile: {
              name: 'Edit',
              iconClass: 'fa-edit',
              onClick: function() {
                console.log("'Edit' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            copyFile: {
              name: 'Copy',
              iconClass: 'fa-copy',
              onClick: function() {
                console.log("'Copy' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            pasteFile: {
              name: 'Paste',
              iconClass: 'fa-paste',
              onClick: function() {
                console.log("'Paste' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            deleteFile: {
              name: 'Delete',
              iconClass: 'fa-trash',
              onClick: function() {
                console.log("'Delete' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            renameFile: {
              name: 'Rename',
              onClick: function() {
                console.log("'Rename' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            },
            moveFile: {
              name: 'Move',
              onClick: function() {
                console.log("'Move' clicked.");
              },
              isEnabled: function() {
                return true;
              }
            }
          }
        });
      };

    {% verbatim %}
    script#cmdTemplate(type='text/x-handlebars-template').
      <h4>{{ name }}</h4>
      {{#each argument}}
      {{#unless value}}
      <section>
      <label {{#if value}}hidden{{/if}} class="control-label select" for="{{uuid}}">
      {{name}}
      </label>
      {{/unless}}
      {{#ifCond type.engType '==' 'integer'}}
      <input class='form-control spinner validate[required,custom[integer]]' id='{{uuid}}' {{#if value}}type='hidden' value='{{value}}'{{else}}type='text' value='0'{{/if}}'' type='text' required digits />
      {{/ifCond}}
      {{#ifCond type.engType '==' 'float'}}
      <input class='form-control spinner validate[required,custom[integer]]' id='{{uuid}}' {{#if value}}type='hidden' value='{{value}}'{{else}}type='text' value='0'{{/if}}'' type='text' required digits />
      {{/ifCond}}
      {{#ifCond type.engType '==' 'string'}}
      <input class='form-control' id='{{uuid}}' {{#if value}}type='hidden' value='{{value}}'{{else}}type='text' value=''{{/if}}'' type='text' maxlength='{{stringLength}}'/>
      {{/ifCond}}
      {{#ifCond type.engType '==' 'enumeration'}}
        <select class="form-control" id="{{uuid}}">
          {{#each type.enumValue}}
            <option value='{{value}}' {{#ifCond ../value '==' label}}selected{{/ifCond}}>{{label}}</option>
          {{/each}}
        </select>
      </label>
      <i></i>
      </section>
      {{/ifCond}}
      {{/each}}

    script#navBarTemplate(type='text/x-handlebars-template').
      {{#each files}}
      {{#ifCond type '==' 'dir'}}
      <li class="">
      <a href="#" onclick="getWorkspaceDir('{{path}}');"><i class="fa fa-lg fa-fw fa-folder-o"></i> <span class="menu-item-parent">{{name}}</span></a>
      <ul data-path='{{path}}'>
      </ul>
      </li>
      {{else}}
      {{#ifCond ext '==' 'jade'}}
      <li><a href="{{url}}" title="{{name}}"><i class="fa icon-html"></i>{{name}}</a></li>
      {{/ifCond}}
      {{#ifCond ext '==' 'pug'}}
      <li><a href="{{url}}" title="{{name}}"><i class="fa icon-html"></i>{{name}}</a></li>
      {{/ifCond}}
      {{#ifCond ext '==' 'html'}}
      <li><a href="{{url}}" title="{{name}}"><i class="fa icon-html"></i>{{name}}</a></li>
      {{/ifCond}}
      {{#ifCond ext '==' 'js'}}
      <li><a href="{{url}}" title="{{name}}"><i class="fa icon-javascript-alt"></i>{{name}}</a></li>
      {{/ifCond}}
      {{#ifCond ext '==' 'py'}}
      <li><a href="{{url}}" title="{{name}}"><i class="fa icon-python-alt"></i>{{name}}</a></li>
      {{/ifCond}}
      {{#ifCond ext '==' 'pyc'}}
      <li><a href="{{url}}" title="{{name}}"><i class="fa icon-python-alt"></i>{{name}}</a></li>
      {{/ifCond}}
      {{/ifCond}}
      {{/each}}
    {% endverbatim %}


